@model ABCRetailers.Models.ViewModels.HomeViewModel
@{
    ViewData["Title"] = "Customer Dashboard";
}

<div class="customer-hero mb-4">
    <div>
        <p class="text-uppercase text-muted mb-1">Welcome back</p>
        <h1 class="display-6 fw-bold text-primary">Hi @ViewBag.UserName!</h1>
        <p class="lead mb-0">Shop our latest arrivals and keep track of your orders in one place.</p>
    </div>
    <img src="https://cdn-icons-png.flaticon.com/512/2331/2331970.png" alt="Shopping" />
</div>

<div id="antiForgeryTokenContainer" style="display:none;">
    @Html.AntiForgeryToken()
</div>

<!-- Customer Quick Actions -->
<div class="row g-4 mb-5">
    <div class="col-md-4">
        <div class="customer-card shadow-sm">
            <i class="fas fa-store text-success"></i>
            <h4>Browse Products</h4>
            <p class="text-muted">(@Model.ProductCount products available)</p>
            <a asp-controller="Product" asp-action="Index" class="btn btn-success w-100">Go to Products</a>
        </div>
    </div>
    <div class="col-md-4">
        <div class="customer-card shadow-sm">
            <i class="fas fa-shopping-cart text-warning"></i>
            <h4>My Cart</h4>
            <p class="text-muted">Review items before checkout.</p>
            <a asp-controller="Cart" asp-action="Index" class="btn btn-warning w-100 text-dark">View Cart</a>
        </div>
    </div>
    <div class="col-md-4">
        <div class="customer-card shadow-sm">
            <i class="fas fa-receipt text-info"></i>
            <h4>My Orders</h4>
            <p class="text-muted">(@Model.OrderCount total orders)</p>
            <a asp-controller="Order" asp-action="MyOrders" class="btn btn-info w-100 text-white">Track Orders</a>
        </div>
    </div>
</div>

<!-- Featured Products -->
<div class="row">
    <div class="col-12">
        <h2 class="mb-4">
            <i class="fas fa-star text-warning"></i> Featured Products
        </h2>

        @if (Model.FeaturedProducts.Any())
        {
            <div class="row justify-content-center">
                @foreach (var product in Model.FeaturedProducts)
                {
                    <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-4">
                        <div class="card h-100 shadow-sm">
                            @if (!string.IsNullOrEmpty(product.ImageUrl))
                            {
                                <img src="@product.ImageUrl" class="card-img-top" alt="@product.ProductName" style="height: 150px; object-fit: cover;">
                            }
                            else
                            {
                                <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 150px;">
                                    <i class="fas fa-image fa-3x text-muted"></i>
                                </div>
                            }
                            <div class="card-body d-flex flex-column">
                                <h6 class="card-title text-center">@product.ProductName</h6>
                                <p class="card-text small text-muted flex-grow-1 text-center">@(product.Description.Length > 50 ? product.Description.Substring(0, 50) + "..." : product.Description)</p>
                                <div class="mt-auto text-center">
                                    <p class="card-text">
                                        <strong class="text-success">@product.Price.ToString("C")</strong>
                                    </p>
                                    <small class="text-muted">Stock: @product.StockAvailable</small>
                                    @if (product.StockAvailable > 0)
                                    {
                                        <div class="mt-2">
                                            <button type="button" class="btn btn-sm btn-success add-to-cart" data-product-id="@product.RowKey" data-product-name="@product.ProductName">
                                                <i class="fas fa-cart-plus"></i> Add to Cart
                                            </button>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> No products available yet. Check back soon!
            </div>
        }
    </div>
</div>

<section class="mt-4">
    <div class="row g-3">
        <div class="col-md-6">
            <div class="alert alert-light shadow-sm d-flex align-items-center">
                <i class="fas fa-upload text-primary fa-2x me-3"></i>
                <div>
                    <h5 class="mb-1">Upload Proof of Payment</h5>
                    <p class="mb-2 text-muted">Submit your slip for quick order processing.</p>
                    <a asp-controller="Upload" asp-action="Index" class="btn btn-outline-primary btn-sm">Upload Proof</a>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="alert alert-light shadow-sm d-flex align-items-center">
                <i class="fas fa-shield-alt text-secondary fa-2x me-3"></i>
                <div>
                    <h5 class="mb-1">Need a refresher?</h5>
                    <p class="mb-2 text-muted">Read our privacy policy and terms.</p>
                    <a asp-controller="Home" asp-action="Privacy" class="btn btn-outline-secondary btn-sm">Privacy Policy</a>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        $(document).ready(function() {
            $('.add-to-cart').on('click', function() {
                var productId = $(this).data('product-id');
                var productName = $(this).data('product-name');
                var button = $(this);

                $.ajax({
                    url: '@Url.Action("Add", "Cart")',
                    type: 'POST',
                    data: {
                        productId: productId,
                        quantity: 1,
                        __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val()
                    },
                    success: function(response) {
                        if (response.success) {
                            alert(response.message || 'Item added to cart!');
                            button.html('<i class="fas fa-check"></i> Added');
                            button.removeClass('btn-success').addClass('btn-secondary');
                            setTimeout(function() {
                                button.html('<i class="fas fa-cart-plus"></i> Add to Cart');
                                button.removeClass('btn-secondary').addClass('btn-success');
                            }, 2000);
                        } else {
                            alert(response.message || 'Error adding item to cart.');
                        }
                    },
                    error: function() {
                        alert('Error adding item to cart.');
                    }
                });
            });
        });
    </script>
}

<style>
    .customer-hero {
        background: linear-gradient(135deg, #fef6e4, #e0f7ff);
        border-radius: 1rem;
        padding: 2rem;
        display: flex;
        gap: 2rem;
        align-items: center;
        box-shadow: 0 1rem 2rem rgba(0,0,0,0.08);
    }

        .customer-hero img {
            width: 120px;
            height: 120px;
        }

    .customer-card {
        border-radius: 1rem;
        padding: 1.5rem;
        background-color: #fff;
        text-align: center;
    }

        .customer-card i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
</style>

